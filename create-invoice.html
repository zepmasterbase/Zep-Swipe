<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zep Swipe — Create Invoice</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@300;400,500,600&display=swap" rel="stylesheet">

<style>
:root{
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --bg:#050018;
  --glass:rgba(255,255,255,.08);
  --text-light:rgba(255,255,255,.85);
  --green:#00ff94;
}

/* RESET */
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,sans-serif;}
body{background:var(--bg);color:#fff;min-height:100vh;}

/* HEADER */
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px;margin-bottom:20px;
  background:rgba(0,0,0,.6);
  border-radius:12px;
  box-shadow:0 0 20px rgba(0,240,255,.3),0 0 40px rgba(156,77,255,.3);
  animation:pulse 2s infinite;
}
@keyframes pulse{
  0%,100%{box-shadow:0 0 20px rgba(0,240,255,.3),0 0 40px rgba(156,77,255,.3);}
  50%{box-shadow:0 0 30px rgba(0,240,255,.5),0 0 60px rgba(156,77,255,.5);}
}
.brand{display:flex;align-items:center;gap:8px;font-family:Orbitron;font-size:1.5rem;}
.brand img{width:40px;height:40px;}
.logout-btn{background:rgba(255,255,255,.1);border:none;border-radius:50%;width:38px;height:38px;color:#fff;cursor:pointer;}

/* DASHBOARD CONTAINER */
.container{max-width:900px;margin:auto;padding:0 16px;display:flex;flex-direction:column;gap:20px;}

/* STUDENT INFO CARD */
.student-card{
  display:flex;align-items:center;gap:16px;
  background:var(--glass);
  padding:16px;border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 0 20px rgba(0,240,255,.15),0 0 40px rgba(156,77,255,.15);
}
.student-card img{width:80px;height:80px;border-radius:50%;border:2px solid rgba(255,255,255,.3);}
.student-card .info{display:flex;flex-direction:column;}
.verified-badge{display:flex;align-items:center;gap:8px;font-family:Orbitron;font-size:12px;padding:4px 8px;border-radius:12px;background:linear-gradient(90deg,var(--green),var(--zep-blue));color:#050015;animation:badgePulse 2s infinite;}
@keyframes badgePulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}

/* FORM SECTIONS */
form{display:flex;flex-direction:column;gap:20px;}
section{background:var(--glass);padding:16px;border-radius:16px;box-shadow:0 0 20px rgba(0,240,255,.1),0 0 40px rgba(156,77,255,.1);}
section h3{font-family:Orbitron;margin-bottom:12px;}
input, textarea, select{width:100%;padding:12px;border:none;border-radius:12px;background:rgba(255,255,255,.05);color:#fff;margin-bottom:10px;outline:none;}
textarea{resize:none;height:80px;}
select{background:rgba(255,255,255,.05);}

/* BUTTONS */
button{
  padding:12px 16px;border:none;border-radius:999px;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050015;font-family:Orbitron;cursor:pointer;
  transition:.3s;margin-top:8px;
}
button:hover{transform:translateY(-2px);box-shadow:0 0 15px var(--zep-blue),0 0 30px var(--zep-violet);}

/* MODAL */
.modal-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;justify-content:center;align-items:center;z-index:1000;
}
.modal{
  background:var(--glass);padding:24px;border-radius:20px;max-width:400px;width:90%;
  text-align:center;box-shadow:0 0 20px rgba(0,240,255,.3),0 0 40px rgba(156,77,255,.3);
}
.modal h3{margin-bottom:12px;font-family:Orbitron;}
.modal input{user-select:all;}
.modal button{margin-top:12px;width:100%;}

/* LOCKED OVERLAY */
.locked-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;justify-content:center;align-items:center;flex-direction:column;z-index:2000;text-align:center;padding:20px;}
.locked-overlay button{margin-top:16px;}
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="https://payhip.com/cdn-cgi/image/format=auto/https://pe56d.s3.amazonaws.com/o_1jfnua21qtu1vi2pfom33p641h.png" alt="Zep Swipe Logo">
    <span>Zep Swipe</span>
  </div>
  <button class="logout-btn" onclick="logout()">⎋</button>
</header>

<div class="container">

  <!-- LOCKED OVERLAY -->
  <div class="locked-overlay" id="lockedOverlay">
    <h2>Verify your account to request payments and unlock global earning</h2>
    <button onclick="location.href='learn-earn.html'">Complete Verification</button>
  </div>

  <!-- STUDENT INFO -->
  <div class="student-card" id="studentCard">
    <img id="studentImg" src="https://payhip.com/cdn-cgi/image/format=auto/https://pe56d.s3.amazonaws.com/o_1jfnu9ifbfep1lrp3a7edu361b.jpg" alt="Student">
    <div class="info">
      <span id="studentName">Siyanda</span>
      <span id="studentUniversity">University Name</span>
      <span id="studentCountry">Country</span>
      <div class="verified-badge" id="verifiedBadge">Verified Freelancer</div>
      <span id="studentWallet">Wallet: 0 ZAC (~$0)</span>
    </div>
  </div>

  <!-- CREATE INVOICE FORM -->
  <form id="invoiceForm">
    <!-- CLIENT INFO -->
    <section>
      <h3>Client Information</h3>
      <input type="text" id="clientName" placeholder="Client Full Name" required>
      <input type="email" id="clientEmail" placeholder="Client Email" required>
      <select id="clientCountry" required>
        <option value="">Select Country</option>
        <option value="Ghana">Ghana</option>
        <option value="South Africa">South Africa</option>
        <option value="Nigeria">Nigeria</option>
        <option value="Kenya">Kenya</option>
        <option value="Other">Other</option>
      </select>
    </section>

    <!-- SERVICE DETAILS -->
    <section>
      <h3>Service Details</h3>
      <input type="text" id="serviceTitle" placeholder="Service Title" required>
      <select id="serviceCategory" required>
        <option value="">Select Category</option>
        <option value="Virtual Assistant">Virtual Assistant</option>
        <option value="Content Creation">Content Creation</option>
        <option value="Writing">Writing</option>
        <option value="Design">Design</option>
        <option value="Data Entry">Data Entry</option>
        <option value="Tutoring">Tutoring</option>
        <option value="Other">Other</option>
      </select>
      <textarea id="serviceDescription" placeholder="Service Description" required></textarea>
      <input type="date" id="deliveryDate" required>
    </section>

    <!-- PRICING -->
    <section>
      <h3>Pricing</h3>
      <select id="currency" required>
        <option value="USD">USD</option>
        <option value="ZAR">ZAR</option>
        <option value="GHS">GHS</option>
        <option value="NGN">NGN</option>
      </select>
      <input type="number" id="amount" placeholder="Amount" min="1" step="0.01" required>
      <div id="breakdown">
        <span>Client Pays: $0</span><br>
        <span>Platform Fee: $0</span><br>
        <span>Student Receives: $0</span>
      </div>
    </section>

    <!-- ESCROW TERMS -->
    <section>
      <input type="checkbox" id="escrowTerms" required> I understand funds will be held in escrow and released after work is submitted and approved.
    </section>

    <button type="submit">Generate Secure Invoice</button>
  </form>

</div>

<!-- SUCCESS MODAL -->
<div class="modal-overlay" id="successModal">
  <div class="modal">
    <h3>✅ Invoice Created Successfully</h3>
    <input type="text" id="invoiceLink" readonly>
    <button onclick="copyLink()">Copy Link</button>
    <button onclick="openInvoice()">Open Invoice</button>
    <button onclick="closeModal()">Close</button>
  </div>
</div>

<script>
/* =====================
   USER SESSION & VERIFICATION
===================== */
let users = JSON.parse(localStorage.getItem("users")) || {};
let currentUserId = localStorage.getItem("currentUserId");
if(!currentUserId || !users[currentUserId]) location.href="login.html";

let currentUser = users[currentUserId];

// Only allow verified students
if(!currentUser.verified){
  document.getElementById("lockedOverlay").style.display="flex";
  document.getElementById("invoiceForm").style.display="none";
}

/* =====================
   STUDENT INFO
===================== */
const studentImg = document.getElementById("studentImg");
const studentName = document.getElementById("studentName");
const studentUniversity = document.getElementById("studentUniversity");
const studentCountry = document.getElementById("studentCountry");
const verifiedBadge = document.getElementById("verifiedBadge");
const studentWallet = document.getElementById("studentWallet");

function loadStudentInfo(){
  studentImg.src = currentUser.profileImage || studentImg.src;
  studentName.innerText = currentUser.name || "Siyanda";
  studentUniversity.innerText = currentUser.university || "University Name";
  studentCountry.innerText = currentUser.country || "Country";
  verifiedBadge.style.display = currentUser.verified ? "flex" : "none";
  studentWallet.innerText = `Wallet: ${currentUser.walletBalance || 0} ZAC (~$${((currentUser.walletBalance||0)*0.0041).toFixed(2)})`;
}
loadStudentInfo();

/* =====================
   FORM & INVOICE CREATION
===================== */
const form = document.getElementById("invoiceForm");
form.addEventListener('submit',(e)=>{
  e.preventDefault();
  // Validate
  const clientName = document.getElementById("clientName").value.trim();
  const clientEmail = document.getElementById("clientEmail").value.trim();
  const clientCountry = document.getElementById("clientCountry").value;
  const serviceTitle = document.getElementById("serviceTitle").value.trim();
  const serviceCategory = document.getElementById("serviceCategory").value;
  const serviceDesc = document.getElementById("serviceDescription").value.trim();
  const deliveryDate = document.getElementById("deliveryDate").value;
  const currency = document.getElementById("currency").value;
  const amount = parseFloat(document.getElementById("amount").value);
  const escrowChecked = document.getElementById("escrowTerms").checked;

  if(!clientName||!clientEmail||!clientCountry||!serviceTitle||!serviceCategory||!serviceDesc||!deliveryDate||!currency||!amount||!escrowChecked){
    alert("Please fill all fields and accept escrow terms.");
    return;
  }

  // Generate unique invoice ID
  const invoiceId = "INV-"+Math.random().toString(36).substring(2,8).toUpperCase();
  const invoice = {
    id: invoiceId,
    studentId: currentUserId,
    studentName: currentUser.name,
    studentWallet: currentUser.walletBalance||0,
    clientName, clientEmail, clientCountry,
    serviceTitle, serviceCategory, serviceDesc, deliveryDate,
    currency, amount,
    status: "Pending",
    created: new Date().toISOString()
  };

  // Save to localStorage
  let invoices = JSON.parse(localStorage.getItem("invoices")) || {};
  invoices[invoiceId] = invoice;
  localStorage.setItem("invoices", JSON.stringify(invoices));

  // Show modal
  const modal = document.getElementById("successModal");
  const linkInput = document.getElementById("invoiceLink");
  linkInput.value = `${location.origin}/invoice.html?invoice_id=${invoiceId}`;
  modal.style.display = "flex";
});

function copyLink(){
  const linkInput = document.getElementById("invoiceLink");
  linkInput.select();
  document.execCommand("copy");
  alert("Link copied!");
}
function openInvoice(){
  const linkInput = document.getElementById("invoiceLink");
  window.open(linkInput.value,"_blank");
}
function closeModal(){
  document.getElementById("successModal").style.display="none";
}

/* =====================
   LOGOUT
===================== */
function logout(){
  localStorage.removeItem("currentUserId");
  location.href="login.html";
}

/* =====================
   PRICING BREAKDOWN DYNAMIC
===================== */
const amountInput = document.getElementById("amount");
const currencySelect = document.getElementById("currency");
const breakdown = document.getElementById("breakdown");

function updateBreakdown(){
  const amount = parseFloat(amountInput.value)||0;
  const fee = (amount*0.1).toFixed(2); // 10% platform fee
  const studentReceives = (amount - fee).toFixed(2);
  breakdown.innerHTML=`Client Pays: ${amount} ${currencySelect.value}<br>Platform Fee: ${fee} ${currencySelect.value}<br>Student Receives: ${studentReceives} ${currencySelect.value}`;
}

amountInput.addEventListener('input',updateBreakdown);
currencySelect.addEventListener('change',updateBreakdown);
updateBreakdown();

</script>
</body>
</html>