<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zep Swipe ‚Äî Student Deals</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@300;400,500,600&display=swap" rel="stylesheet">
<style>
:root{
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --bg:radial-gradient(circle at 30% 10%, #050018, #00000c);
  --glass:rgba(255,255,255,.08);
  --text-light:rgba(255,255,255,.85);
  --green:#00ff94;
  --card-glow:rgba(156,77,255,.3);
}

/* RESET */
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,sans-serif;}
body{background:var(--bg);color:#fff;min-height:100vh;line-height:1.4;}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 20px;
  max-width:1200px;
  margin:auto;
  border-radius:12px;
  background:rgba(0,0,0,0.15);
  box-shadow:0 0 20px var(--zep-blue),0 0 40px var(--zep-violet);
}
.brand{
  font-family:Orbitron;
  font-size:1.6rem;
  display:flex;
  align-items:center;
}
.brand img{height:40px;margin-right:10px;}
.home-btn{
  background:linear-gradient(135deg,var(--zep-blue),var(--zep-violet));
  border:none;border-radius:50%;
  width:50px;height:50px;
  cursor:pointer;font-size:20px;color:#050015;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 0 12px var(--zep-blue),0 0 25px var(--zep-violet);
  transition:transform .3s,box-shadow .3s;
}
.home-btn:hover{transform:scale(1.1);}

/* CONTAINER */
.container{padding:20px;max-width:1200px;margin:auto;}
h2{text-align:center;font-family:Orbitron;margin-bottom:20px;}

/* DEAL CARDS */
.deals-list{display:grid;grid-template-columns:1fr;gap:16px;}
@media(min-width:600px){.deals-list{grid-template-columns:1fr 1fr;}}
.deal-card{
  background:var(--glass);border-radius:16px;padding:16px;border:1px solid rgba(255,255,255,.12);
  display:flex;flex-direction:column;gap:8px;transition:.3s;position:relative;
}
.deal-card:hover{transform:translateY(-2px);box-shadow:0 0 20px var(--card-glow);}
.deal-card h3{font-size:1.2rem;margin-bottom:4px;}
.deal-card p{font-size:.95rem;color:var(--text-light);}
.deal-meta{font-size:.8rem;color:var(--text-light);display:flex;justify-content:space-between;align-items:center;}
.badge{padding:4px 8px;border-radius:999px;font-size:.75rem;font-weight:600;text-transform:uppercase;}
.badge.active{background:var(--green);color:#050015;}
.badge.locked{background:#aaa;color:#050015;}

/* MODAL */
.modal{
  position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);
  display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;
  transition:opacity .3s ease;
}
.modal.active{visibility:visible;opacity:1;}
.modal-content{
  background:var(--glass);padding:20px;border-radius:16px;max-width:400px;width:90%;position:relative;
  box-shadow:0 0 30px var(--zep-violet);
}
.modal-content h3{margin-bottom:12px;}
.modal-content p{margin-bottom:12px;color:var(--text-light);}
.modal-content .code{font-family:Orbitron;font-size:1.3rem;color:var(--green);margin:12px 0;text-align:center;}
.modal-content button{
  padding:12px 18px;border:none;border-radius:999px;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050015;font-family:Orbitron;cursor:pointer;width:100%;transition:.3s;
}
.modal-content button:hover{transform:translateY(-2px);box-shadow:0 0 36px rgba(156,77,255,.45);}
.modal-close{
  position:absolute;top:10px;right:10px;cursor:pointer;font-size:20px;color:#fff;
}

/* LOCKED MESSAGE */
.locked-message{
  text-align:center;margin:20px 0;font-size:0.95rem;color:var(--text-light);
}
.locked-message button{
  margin-top:10px;padding:10px 16px;border:none;border-radius:999px;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050015;font-family:Orbitron;cursor:pointer;transition:.3s;
}
.locked-message button:hover{transform:translateY(-2px);box-shadow:0 0 20px var(--zep-blue),0 0 40px var(--zep-violet);}
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="https://payhip.com/cdn-cgi/image/format=auto/https://pe56d.s3.amazonaws.com/o_1jfnua21qtu1vi2pfom33p641h.png" alt="Logo">
    Zep Swipe
  </div>
  <button class="home-btn" title="Home" onclick="location.href='student-dashboard.html'">üè†</button>
</header>

<div class="container">
  <h2>Student Deals Marketplace</h2>
  <div id="dealsContainer" class="deals-list"></div>

  <div class="locked-message" id="lockedMessage" style="display:none;">
    Verify your account and complete Day 5 tasks to unlock deals.
    <br>
    <button onclick="location.href='learn-earn.html'">Go to Learn & Earn</button>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="dealModal">
  <div class="modal-content">
    <span class="modal-close" id="modalClose">&times;</span>
    <h3 id="modalStore"></h3>
    <p id="modalDesc"></p>
    <p class="code" id="modalCode"></p>
    <p>Expires in 3 days</p>
    <button id="redeemBtn">Redeem Now</button>
  </div>
</div>

<script>
// Mock current user
let currentUser = JSON.parse(localStorage.getItem("currentUser")) || {verified:false,tasksCompleted:0,name:"Siyanda"};
// Redirect if not verified or tasks <5
if(!currentUser.verified || currentUser.tasksCompleted < 5){
  window.location.href="learn-earn.html";
}

// Mock deals with lat/lng
const studentDeals = [
  {id:1,business:"Cafe Mocha",desc:"Free coffee with any snack",lat: -1.2921, lng:36.8219},
  {id:2,business:"Tech Store",desc:"10% off student laptops",lat: -1.2925,lng:36.8222},
  {id:3,business:"BookWorld",desc:"Buy 1 Get 1 free textbook",lat:-1.293,lng:36.823},
  {id:4,business:"CinemaX",desc:"Student tickets $5",lat:-1.294,lng:36.824},
  {id:5,business:"GymPlus",desc:"Free 1-week trial",lat:-1.295,lng:36.825},
];

const dealsContainer = document.getElementById("dealsContainer");
const modal = document.getElementById("dealModal");
const modalClose = document.getElementById("modalClose");
const modalStore = document.getElementById("modalStore");
const modalDesc = document.getElementById("modalDesc");
const modalCode = document.getElementById("modalCode");
const redeemBtn = document.getElementById("redeemBtn");

// Haversine formula for distance in miles
function getDistance(lat1, lon1, lat2, lon2){
  const R = 3958.8; // Radius in miles
  const dLat = (lat2-lat1)*Math.PI/180;
  const dLon = (lon2-lon1)*Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  const c = 2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R*c;
}

// Get student location
navigator.geolocation.getCurrentPosition(pos=>{
  const userLat = pos.coords.latitude;
  const userLng = pos.coords.longitude;
  dealsContainer.innerHTML="";

  studentDeals.forEach(deal=>{
    const distance = getDistance(userLat,userLng,deal.lat,deal.lng);
    if(distance>20) return; // filter >20 miles

    const card = document.createElement("div");
    card.className="deal-card";
    card.innerHTML = `
      <h3>${deal.business}</h3>
      <p>${deal.desc}</p>
      <div class="deal-meta">Distance: ${distance.toFixed(1)} mi</div>
      <button onclick="openModal(${deal.id})">Generate Code</button>
    `;
    dealsContainer.appendChild(card);
  });
},err=>{
  alert("Location access is required to view nearby deals.");
});

// Modal functions
function openModal(dealId){
  const deal = studentDeals.find(d=>d.id===dealId);
  modalStore.innerText = deal.business;
  modalDesc.innerText = deal.desc;
  // Unique code per student + deal
  const code = `ZEP-${currentUser.name.substring(0,3).toUpperCase()}-${deal.id}-${Date.now().toString().slice(-4)}`;
  modalCode.innerText = code;
  redeemBtn.onclick = ()=>{
    alert(`Redeemed: ${code} at ${deal.business}`);
    modal.classList.remove("active");
  };
  modal.classList.add("active");
}
modalClose.onclick = ()=>{modal.classList.remove("active");};
window.onclick = e=>{if(e.target===modal) modal.classList.remove("active");};
</script>
</body>
</html>