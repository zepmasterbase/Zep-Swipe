<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zep Swipe — Learn & Earn</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@300;400;500,600&display=swap" rel="stylesheet">
<style>
:root{
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --bg:radial-gradient(circle at 30% 10%, #050018, #00000c);
  --glass:rgba(255,255,255,.08);
  --text-light:rgba(255,255,255,.85);
  --accent:#00ff9d;
  --streak:#ffea00;
  --card-bg:rgba(255,255,255,.05);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,sans-serif;}
body{background:var(--bg);color:#fff;min-height:100vh;line-height:1.4;overflow-x:hidden;}
a{text-decoration:none;color:inherit;}
button{cursor:pointer;border:none;}

header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 20px;max-width:1200px;margin:auto;margin-top:10px;
  border-radius:12px;background:rgba(0,0,0,0.15);backdrop-filter:blur(6px);
}
.brand{
  font-family:Orbitron;font-size:1.6rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  animation: pulseGlow 2s infinite;
}
.home-btn{
  background:var(--zep-blue);color:#050015;padding:6px 12px;border-radius:12px;font-weight:700;transition:.3s;
}
.home-btn:hover{transform:scale(1.05);}
@keyframes pulseGlow{
  0% { text-shadow: 0 0 5px var(--zep-blue),0 0 10px var(--zep-violet); transform: scale(1);}
  50% { text-shadow: 0 0 15px var(--zep-blue),0 0 25px var(--zep-violet); transform: scale(1.05);}
  100% { text-shadow: 0 0 5px var(--zep-blue),0 0 10px var(--zep-violet); transform: scale(1);}
}

.student-info{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 20px;max-width:1200px;margin:20px auto;
  background:var(--card-bg);border-radius:16px;backdrop-filter:blur(6px);
}
.student-info div{display:flex;flex-direction:column;}
.student-info div span{font-size:0.85rem;color:var(--text-light);}
.wallet-balance{font-weight:700;font-family:Orbitron;}

.programs{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;max-width:1200px;margin:0 auto 20px;padding:0 20px;
}
.program-card{
  padding:14px;border-radius:16px;text-align:center;
  background:var(--card-bg);cursor:pointer;transition:.3s;position:relative;
  box-shadow:0 0 10px rgba(0,240,255,0.2),0 0 10px rgba(156,77,255,0.2);
}
.program-card:hover{
  transform:translateY(-3px) scale(1.05);
  box-shadow:0 0 20px var(--zep-blue),0 0 40px var(--zep-violet);
}
.program-card.selected{border:2px solid var(--zep-blue);box-shadow:0 0 15px var(--zep-blue);}

.tasks-container{display:grid;grid-template-columns:1fr;gap:16px;max-width:1200px;margin:auto;padding:0 20px 40px;}
@media(min-width:600px){.tasks-container{grid-template-columns:1fr 1fr;}}
@media(min-width:900px){.tasks-container{grid-template-columns:1fr 1fr 1fr;}}

.task-card{
  background:var(--card-bg);border-radius:16px;padding:16px;
  position:relative;transition:.3s;display:flex;flex-direction:column;gap:8px;
}
.task-card.locked{opacity:0.5;filter:grayscale(70%);}
.task-card h4{margin-bottom:6px;font-size:1rem;}
.task-card p{font-size:0.85rem;color:var(--text-light);}
.task-card input[type="text"]{padding:8px;border-radius:12px;border:none;background:rgba(255,255,255,0.1);color:#fff;outline:none;}
.task-card button{
  padding:8px 16px;border:none;border-radius:999px;background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050015;font-family:Orbitron;cursor:pointer;transition:.3s;
}
.task-card button:hover{
  transform:translateY(-2px) scale(1.02);box-shadow:0 0 15px var(--zep-blue),0 0 30px var(--zep-violet);
}

.progress-bar-container{max-width:1200px;margin:20px auto;padding:0 20px;}
.progress-bar{width:100%;height:16px;background:rgba(255,255,255,0.1);border-radius:12px;overflow:hidden;}
.progress-bar-fill{height:100%;width:0%;background:var(--accent);border-radius:12px;transition:width 0.5s ease-in-out;}

.streak-badge{
  display:inline-block;margin-right:6px;padding:4px 8px;border-radius:12px;background:var(--streak);color:#050015;font-weight:600;font-size:0.75rem;transition:.3s;
  transform:scale(1);
}
.streak-badge.earned{animation:pop 0.5s ease forwards;}
@keyframes pop{0%{transform:scale(0.5);}50%{transform:scale(1.2);}100%{transform:scale(1);}}

#verificationBanner{
  max-width:1200px;margin:20px auto;padding:16px;border-radius:16px;text-align:center;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  cursor:pointer;font-family:Orbitron;font-weight:700;transition:.3s;
}
#verificationBanner:hover{transform:translateY(-2px);box-shadow:0 0 20px var(--zep-blue),0 0 40px var(--zep-violet);}
</style>
</head>
<body>

<header>
  <div class="brand">Zep Swipe</div>
  <button class="home-btn" onclick="location.href='student-dashboard.html'">Home</button>
</header>

<div class="student-info">
  <div>
    <span id="studentName"></span>
    <span id="studentCity"></span>
    <span id="studentCountry"></span>
    <span id="studentUni"></span>
    <span id="studentProgram">Program: <strong>--</strong></span>
  </div>
  <div class="wallet-balance">Wallet: <span id="walletBalance">0</span> ZAC</div>
  <div><a href="profile.html">Profile</a></div>
</div>

<div class="programs" id="programsContainer"></div>

<div class="progress-bar-container">
  <div class="progress-bar">
    <div class="progress-bar-fill" id="progressFill"></div>
  </div>
</div>

<div id="streakContainer" style="max-width:1200px;margin:10px auto;padding:0 20px;"></div>

<div class="tasks-container" id="tasksContainer"></div>

<div id="verificationBanner" onclick="payVerification()">Become a Verified Freelancer – $5</div>

<script src="https://checkout.flutterwave.com/v3.js"></script>
<script>
/* ======================= */
/* USERS + CURRENT USER SYSTEM */
let users = JSON.parse(localStorage.getItem("users")) || [];
let currentUserId = localStorage.getItem("currentUserId");
let currentUser = users.find(u=>u.id===currentUserId);

if(!currentUser) location.href="login.html";

/* INITIAL INFO */
document.getElementById('studentName').innerText = currentUser.name;
document.getElementById('studentCity').innerText = "City: " + (currentUser.city||"--");
document.getElementById('studentCountry').innerText = "Country: " + (currentUser.country||"--");
document.getElementById('studentUni').innerText = currentUser.university;
document.getElementById('studentProgram').querySelector('strong').innerText = currentUser.program || '--';
document.getElementById('walletBalance').innerText = currentUser.walletBalance || 0;

/* PROGRAMS */
const programs = ["Virtual Assistant","Content Creator"];
const programsContainer = document.getElementById('programsContainer');
programs.forEach(prog=>{
  const card = document.createElement('div');
  card.className='program-card';
  if(currentUser.program===prog) card.classList.add('selected');
  card.innerText = prog;
  card.onclick = ()=>{
    currentUser.program = prog;
    updateUser();
    document.querySelectorAll('.program-card').forEach(c=>c.classList.remove('selected'));
    card.classList.add('selected');
    document.getElementById('studentProgram').querySelector('strong').innerText = prog;
    renderTasks(prog);
  }
  programsContainer.appendChild(card);
});

/* TASKS */
const taskTemplates = {
  "Virtual Assistant":[
    "Record an intro video of yourself, sign up on www.zora.co, upload the video to your profile, copy the link, and submit it on Zep Swipe to complete the task.",
    "Organize your email inbox efficiently",
    "Create a daily to-do list"
  ],
  "Content Creator":[
    "Create a 30-second introduction video for your portfolio",
    "Draft a content plan for a week",
    "Publish one social media post"
  ]
};

const tasksContainer = document.getElementById('tasksContainer');
const progressFill = document.getElementById('progressFill');
const streakContainer = document.getElementById('streakContainer');

function renderTasks(program){
  tasksContainer.innerHTML='';
  streakContainer.innerHTML='';
  if(!currentUser.tasksCompleted) currentUser.tasksCompleted=[];
  const programTasks = taskTemplates[program] || [];
  for(let day=1; day<=programTasks.length; day++){
    const taskCard = document.createElement('div');
    taskCard.className='task-card';
    const completed = currentUser.tasksCompleted.includes(`${program}-${day}`);
    if(day>1 && !currentUser.tasksCompleted.includes(`${program}-${day-1}`)) taskCard.classList.add('locked');
    taskCard.innerHTML=`
      <h4>Day ${day}</h4>
      <p>${programTasks[day-1]}</p>
      <input type="text" placeholder="Submit Zora link" ${taskCard.classList.contains('locked')?'disabled':''} id="taskInput${day}">
      <button ${taskCard.classList.contains('locked')?'disabled':''}>Submit (+25 ZAC)</button>
    `;
    tasksContainer.appendChild(taskCard);

    if(completed){
      taskCard.querySelector('button').disabled=true;
      taskCard.querySelector('input').disabled=true;
      addStreakBadge(day);
    }

    if(!taskCard.classList.contains('locked')){
      const btn = taskCard.querySelector('button');
      btn.onclick = ()=>{
        const input = document.getElementById(`taskInput${day}`);
        if(!input.value.trim()){ alert("Please submit a valid Zora link"); return;}
        const taskKey = `${program}-${day}`;
        if(!currentUser.tasksCompleted.includes(taskKey)) currentUser.tasksCompleted.push(taskKey);
        currentUser.walletBalance = (currentUser.walletBalance||0)+25;
        updateUser();
        btn.disabled = true; input.disabled = true;
        addStreakBadge(day);
        const nextTask = tasksContainer.children[day];
        if(nextTask){
          nextTask.classList.remove('locked');
          nextTask.querySelector('button').disabled=false;
          nextTask.querySelector('input').disabled=false;
        }
        progressFill.style.width=`${(currentUser.tasksCompleted.filter(t=>t.startsWith(program)).length/programTasks.length)*100}%`;
        if(currentUser.tasksCompleted.filter(t=>t.startsWith(program)).length===programTasks.length && !currentUser.verified) document.getElementById('verificationBanner').style.display='block';
      }
    }
  }
  progressFill.style.width=`${(currentUser.tasksCompleted.filter(t=>t.startsWith(program)).length/programTasks.length)*100}%`;
}

function addStreakBadge(day){
  const badge = document.createElement('span');
  badge.className='streak-badge earned';
  badge.innerText=`Day ${day} ✅`;
  streakContainer.appendChild(badge);
}

/* UPDATE USER IN LOCALSTORAGE */
function updateUser(){
  const idx = users.findIndex(u=>u.id===currentUser.id);
  if(idx>-1) users[idx] = currentUser;
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("currentUserId", currentUser.id);
  document.getElementById('walletBalance').innerText = currentUser.walletBalance;
}

/* INITIAL RENDER */
if(currentUser.program) renderTasks(currentUser.program);

/* ================= FLUTTERWAVE PAYMENT INTEGRATION */
function payVerification(){
  if(currentUser.verified){ alert("Already verified!"); return;}
  FlutterwaveCheckout({
    public_key: "FLWPUBK_TEST-xxxxxxxxxxxx", // replace with your public key
    tx_ref: "VERIF-"+Date.now(),
    amount: 5,
    currency: "USD",
    payment_options: "card,mobilemoney",
    customer:{
      email: currentUser.email || "student@example.com",
      name: currentUser.name || "Student"
    },
    callback: function(data){
      if(data.status==="successful"){
        currentUser.verified = true;
        updateUser();
        alert("Payment Successful! You are now a verified freelancer ✅");
      } else { alert("Payment failed. Please try again."); }
    },
    onclose: function(){ console.log("Payment closed"); }
  });
}
</script>
</body>
</html>