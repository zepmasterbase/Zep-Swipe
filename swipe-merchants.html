<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Swipe Merchants ‚Äî Zep Swipe</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>

<style>
:root{
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --bg:radial-gradient(circle at 20% 10%, #06001c 0%, #000010 100%);
  --glass:rgba(255,255,255,0.06);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:var(--bg);
  color:#fff;
}
.container{
  max-width:1100px;
  margin:24px auto 120px;
  padding:16px;
}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  border-radius:18px;
  background:var(--glass);
  border:1px solid rgba(255,255,255,.12);
  backdrop-filter:blur(16px);
  box-shadow:0 0 36px rgba(0,240,255,.25);
}
.brand{
  font-family:Orbitron;
  font-size:1.4rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.header-actions{
  display:flex;
  gap:10px;
  align-items:center;
}
.icon-btn{
  width:42px;height:42px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  background:linear-gradient(135deg,var(--zep-blue),var(--zep-violet));
  color:#050015;
  font-size:18px;
  box-shadow:0 0 20px rgba(0,240,255,.4);
}

/* GRID */
.section-title{
  margin:26px 0 14px;
  font-family:Orbitron;
  font-size:1.2rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
}
@media(max-width:760px){
  .grid{grid-template-columns:1fr}
}

/* CARD */
.card{
  padding:16px;
  border-radius:18px;
  background:rgba(0,0,0,.65);
  border:1px solid rgba(255,255,255,.12);
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.card h3{
  margin:0;
  font-family:Orbitron;
  font-size:1rem;
}
.card p{
  font-size:12px;
  opacity:.85;
}
.meta{
  font-size:11px;
  opacity:.75;
}
.price{
  font-family:Orbitron;
  font-size:1.1rem;
  margin-top:6px;
}
.card-actions{
  margin-top:12px;
  display:flex;
  gap:8px;
}
.btn{
  flex:1;
  padding:10px;
  border-radius:999px;
  border:none;
  font-family:Orbitron;
  font-size:11px;
  cursor:pointer;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050015;
}
.btn.secondary{
  background:none;
  border:1px solid rgba(255,255,255,.25);
  color:#fff;
}
.status{
  margin-top:8px;
  font-size:11px;
  opacity:.8;
}
</style>
</head>

<body>

<div class="container">

  <!-- HEADER -->
  <div class="header">
    <div class="brand">Swipe Merchants</div>

    <div class="header-actions">
      <!-- Student shortcuts -->
      <div id="studentNav" style="display:none;gap:10px">
        <div class="icon-btn" title="Student Dashboard"
             onclick="location.href='student-dashboard.html'">üéì</div>
        <div class="icon-btn" title="Learn & Earn"
             onclick="location.href='learn-earn.html'">üß†</div>
      </div>

      <!-- Logout -->
      <div class="icon-btn" title="Logout" onclick="logout()">‚èª</div>
    </div>
  </div>

  <!-- MARKET -->
  <div class="section-title">Browse Student Services</div>
  <div class="grid" id="marketGrid"></div>

</div>

<script>
/* ---------------- CONFIG ---------------- */
const USDC = "0x833589fCD6eDb6E08f4c7C32D4f71b54bda02913";
const ERC20_ABI=[
  "function transfer(address,uint256) returns(bool)",
  "function decimals() view returns(uint8)"
];

/* ---------------- SESSION ---------------- */
const student = JSON.parse(localStorage.getItem("zepStudent"));
if(student){
  document.getElementById("studentNav").style.display="flex";
}

/* ---------------- SAMPLE SERVICES ---------------- */
const services=[
 {
  id:1,
  title:"AI Content Writer",
  desc:"SEO blogs, LinkedIn posts & captions",
  price:25,
  seller:"0xSELLER_WALLET_1",
  sellerName:"Ada ¬∑ UNILAG",
 },
 {
  id:2,
  title:"No-Code Automation",
  desc:"Zapier & workflow automation",
  price:40,
  seller:"0xSELLER_WALLET_2",
  sellerName:"Samuel ¬∑ Covenant",
 },
 {
  id:3,
  title:"Graphic Design",
  desc:"Logos, flyers & brand kits",
  price:30,
  seller:"0xSELLER_WALLET_3",
  sellerName:"Zainab ¬∑ ABU",
 },
 {
  id:4,
  title:"Landing Page Builder",
  desc:"Webflow & Framer pages",
  price:50,
  seller:"0xSELLER_WALLET_4",
  sellerName:"Daniel ¬∑ Ashesi",
 }
];

let provider, signer;

/* ---------------- RENDER ---------------- */
const grid=document.getElementById("marketGrid");
services.forEach(s=>{
 const el=document.createElement("div");
 el.className="card";
 el.innerHTML=`
  <div>
    <h3>${s.title}</h3>
    <p>${s.desc}</p>
    <div class="meta">Seller: ${s.sellerName}</div>
    <div class="price">${s.price} USDC</div>
  </div>
  <div>
    <div class="card-actions">
      <button class="btn secondary" onclick="viewSeller(${s.id})">Profile</button>
      <button class="btn" onclick="buy(${s.id})">Buy</button>
    </div>
    <div class="status" id="status-${s.id}"></div>
  </div>
 `;
 grid.appendChild(el);
});

/* ---------------- BUY FLOW ---------------- */
async function buy(id){
 const svc=services.find(x=>x.id===id);
 const status=document.getElementById(`status-${id}`);

 if(!window.ethereum){
  alert("Wallet required");
  return;
 }

 try{
  provider=new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts",[]);
  signer=await provider.getSigner();

  status.textContent="Processing payment‚Ä¶";
  const token=new ethers.Contract(USDC,ERC20_ABI,signer);
  const dec=await token.decimals();
  const tx=await token.transfer(
    svc.seller,
    ethers.parseUnits(svc.price.toString(),dec)
  );
  await tx.wait();

  status.textContent="‚úÖ Paid ‚Äî opening chat‚Ä¶";
  setTimeout(()=>{
    location.href=`order-chat.html?service=${id}`;
  },800);

 }catch(e){
  console.error(e);
  status.textContent="‚ùå Transaction failed";
 }
}

/* ---------------- SELLER PROFILE ---------------- */
function viewSeller(id){
 location.href=`seller-profile.html?service=${id}`;
}

/* ---------------- LOGOUT ---------------- */
function logout(){
 localStorage.removeItem("zepStudent");
 localStorage.removeItem("zepUser");
 location.href="index.html";
}
</script>

</body>
</html>