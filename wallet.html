<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Zep Swipe ‚Äî Wallet</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>

<style>
:root{
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --glass:rgba(255,255,255,.06);
  --bg:radial-gradient(circle at 25% 10%, #020014 0%, #00000a 100%);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:var(--bg);
  color:#fff;
}
.container{
  max-width:920px;
  margin:26px auto 140px;
  padding:16px;
}

/* Header */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  border-radius:18px;
  background:var(--glass);
  border:1px solid rgba(255,255,255,.12);
  backdrop-filter:blur(16px);
  box-shadow:0 0 28px rgba(0,240,255,.25);
}
.brand{
  font-family:Orbitron;
  font-size:1.4rem;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.addr{
  font-family:Orbitron;
  font-size:.85rem;
  cursor:pointer;
}

/* Cards */
.card{
  margin-top:20px;
  padding:18px;
  border-radius:20px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.12);
}
.section-title{
  font-family:Orbitron;
  font-size:1.1rem;
  margin-bottom:14px;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* Assets */
.asset{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  border-radius:16px;
  background:rgba(0,0,0,.6);
  border:1px solid rgba(255,255,255,.12);
  margin-bottom:12px;
}
.asset-left{display:flex;gap:14px;align-items:center}
.coin{
  width:54px;height:54px;
  border-radius:14px;
  background:linear-gradient(135deg,var(--zep-blue),var(--zep-violet));
  display:flex;align-items:center;justify-content:center;
  font-family:Orbitron;color:#050015;
}
.asset-name{font-family:Orbitron;font-size:.9rem}
.asset-sub{font-size:11px;opacity:.8}
.asset-right{text-align:right}
.asset-right strong{font-family:Orbitron}
.actions{margin-top:6px;display:flex;gap:6px}

.btn{
  padding:6px 12px;
  border-radius:999px;
  border:none;
  font-size:11px;
  font-family:Orbitron;
  cursor:pointer;
  background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));
  color:#050015;
}
.btn.secondary{
  background:none;
  border:1px solid rgba(255,255,255,.25);
  color:#fff;
}

/* Activity */
.tx{
  font-size:12px;
  opacity:.85;
  padding:8px 0;
  border-bottom:1px solid rgba(255,255,255,.08);
}

/* Footer */
.footer{
  position:fixed;
  bottom:0;left:0;right:0;
  padding:14px 22px;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(12px);
  display:flex;
  justify-content:space-around;
}
.fbtn{
  width:56px;height:56px;
  border-radius:18px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.1);
  display:flex;align-items:center;justify-content:center;
  font-size:20px;color:#fff;text-decoration:none;
  box-shadow:0 0 22px rgba(0,240,255,.25);
}

/* Modal */
.modal-back{
  position:fixed;inset:0;
  background:rgba(0,0,0,.75);
  display:none;align-items:center;justify-content:center;
  z-index:999;
}
.modal{
  width:92%;max-width:420px;
  background:rgba(10,15,40,.96);
  padding:18px;
  border-radius:20px;
  border:1px solid rgba(255,255,255,.15);
}
input{
  width:100%;
  margin-top:10px;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.2);
  background:#020617;color:#fff;
}
</style>
</head>

<body>

<div class="container">

  <!-- Header -->
  <div class="header">
    <div class="brand">Zep Swipe ¬∑ Wallet</div>
    <div id="walletAddr" class="addr" onclick="copyAddr()">‚Äî</div>
  </div>

  <!-- Assets -->
  <div class="card">
    <div class="section-title">Assets (Base)</div>

    <!-- ZAC -->
    <div class="asset">
      <div class="asset-left">
        <div class="coin">ZAC</div>
        <div>
          <div class="asset-name">Zep Cash</div>
          <div class="asset-sub">Rewards ¬∑ Locked</div>
        </div>
      </div>
      <div class="asset-right">
        <strong id="zacBal">0 ZAC</strong>
        <div class="actions">
          <button class="btn secondary" onclick="copyAddr()">Receive</button>
        </div>
      </div>
    </div>

    <!-- USDC -->
    <div class="asset">
      <div class="asset-left">
        <div class="coin">USDC</div>
        <div>
          <div class="asset-name">USD Coin</div>
          <div class="asset-sub">Payments</div>
        </div>
      </div>
      <div class="asset-right">
        <strong id="usdcBal">‚Äî</strong>
        <div class="actions">
          <button class="btn secondary" onclick="copyAddr()">Receive</button>
          <button class="btn" onclick="openSend('USDC')">Send</button>
        </div>
      </div>
    </div>

    <!-- ETH -->
    <div class="asset">
      <div class="asset-left">
        <div class="coin">ETH</div>
        <div>
          <div class="asset-name">Ethereum</div>
          <div class="asset-sub">Gas</div>
        </div>
      </div>
      <div class="asset-right">
        <strong id="ethBal">‚Äî</strong>
        <div class="actions">
          <button class="btn secondary" onclick="copyAddr()">Receive</button>
          <button class="btn" onclick="openSend('ETH')">Send</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Activity -->
  <div class="card">
    <div class="section-title">On-chain Activity</div>
    <div id="activity"></div>
  </div>

</div>

<!-- Send Modal -->
<div class="modal-back" id="sendModal">
  <div class="modal">
    <h3 id="sendTitle"></h3>
    <input id="to" placeholder="Recipient address"/>
    <input id="amount" placeholder="Amount"/>
    <button class="btn" style="margin-top:12px;width:100%" onclick="send()">Send</button>
    <button class="btn secondary" style="margin-top:8px;width:100%" onclick="closeModal()">Cancel</button>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  <a class="fbtn" href="student-dashboard.html">üè†</a>
  <a class="fbtn" href="learn-earn.html">üéì</a>
  <a class="fbtn" href="profile.html">üë§</a>
</div>

<script>
const USDC="0x833589fCD6eDb6E08f4c7C32D4f71b54bda02913";
const ERC20_ABI=[
 "function balanceOf(address) view returns(uint256)",
 "function decimals() view returns(uint8)",
 "function transfer(address,uint256) returns(bool)",
 "event Transfer(address indexed from,address indexed to,uint256 value)"
];

let provider, signer, user, assetType;

function short(a){return a.slice(0,6)+"..."+a.slice(-4)}

function copyAddr(){
 navigator.clipboard.writeText(user.wallet);
 alert("Wallet copied");
}

function openSend(type){
 assetType=type;
 document.getElementById("sendTitle").textContent="Send "+type;
 document.getElementById("sendModal").style.display="flex";
}

function closeModal(){
 document.getElementById("sendModal").style.display="none";
}

async function send(){
 const to=document.getElementById("to").value;
 const amount=document.getElementById("amount").value;
 if(!to||!amount) return alert("Fill all fields");

 if(assetType==="ETH"){
   const tx=await signer.sendTransaction({to,value:ethers.parseEther(amount)});
   await tx.wait();
 }else{
   const c=new ethers.Contract(USDC,ERC20_ABI,signer);
   const d=await c.decimals();
   const tx=await c.transfer(to,ethers.parseUnits(amount,d));
   await tx.wait();
 }
 alert("Transaction sent");
 location.reload();
}

async function loadActivity(){
 const activity=document.getElementById("activity");
 const block=await provider.getBlockNumber();

 const usdc=new ethers.Contract(USDC,ERC20_ABI,provider);
 const logs=await usdc.queryFilter(usdc.filters.Transfer(null,user.wallet),block-5000,block);

 logs.slice(-5).reverse().forEach(l=>{
   activity.innerHTML+=`<div class="tx">üì• USDC received</div>`;
 });
}

window.onload=async()=>{
 user=JSON.parse(localStorage.getItem("zepStudent"));
 if(!user){location.href="login.html";return;}

 provider=new ethers.BrowserProvider(window.ethereum);
 signer=await provider.getSigner();

 document.getElementById("walletAddr").textContent=short(user.wallet);
 document.getElementById("zacBal").textContent=(user.zacAmount||0)+" ZAC";

 const rpc=new ethers.JsonRpcProvider("https://mainnet.base.org");

 const usdc=new ethers.Contract(USDC,ERC20_ABI,rpc);
 const d=await usdc.decimals();
 const b=await usdc.balanceOf(user.wallet);
 document.getElementById("usdcBal").textContent=
   Number(ethers.formatUnits(b,d)).toFixed(2)+" USDC";

 const eth=await rpc.getBalance(user.wallet);
 document.getElementById("ethBal").textContent=
   Number(ethers.formatEther(eth)).toFixed(4)+" ETH";

 loadActivity();
};
</script>

</body>
</html>