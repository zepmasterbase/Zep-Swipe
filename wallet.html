<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zep Swipe ‚Äî Wallet</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Poppins:wght@300;400,500,600&display=swap" rel="stylesheet">
<style>
:root{
  --zep-blue:#00f0ff;
  --zep-violet:#9c4dff;
  --bg:#050018;
  --glass:rgba(255,255,255,.08);
  --green:#00ff94;
  --purple:#9c4dff;
  --yellow:#ffcc00;
  --text-light:rgba(255,255,255,.85);
}

/* RESET */
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,sans-serif;}
body{background:var(--bg);color:#fff;min-height:100vh;display:flex;flex-direction:column;}

/* HEADER */
header{
  display:flex;justify-content:space-between;align-items:center;padding:16px;
  background:radial-gradient(circle at center, rgba(0,240,255,.1), rgba(156,77,255,.1));
  backdrop-filter:blur(14px);
  box-shadow:0 0 20px var(--zep-blue),0 0 40px var(--zep-violet);
}
.brand{font-family:Orbitron;font-size:1.5rem;background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));-webkit-background-clip:text;-webkit-text-fill-color:transparent;cursor:pointer;}
.home-btn{
  width:60px;height:60px;border-radius:50%;
  background:linear-gradient(135deg,var(--zep-blue),var(--zep-violet));
  display:flex;align-items:center;justify-content:center;
  font-size:24px;cursor:pointer;color:#050015;
  box-shadow:0 0 20px var(--zep-blue),0 0 40px var(--zep-violet);
  transition:.3s;
}
.home-btn:hover{transform:scale(1.1);}

/* CONTAINER */
.container{max-width:1000px;margin:20px auto;padding:16px;display:flex;flex-direction:column;gap:20px;}

/* BALANCE CARDS */
.balance-card{background:var(--glass);padding:20px;border-radius:18px;border:1px solid rgba(255,255,255,.12);display:flex;justify-content:space-between;align-items:center;box-shadow:0 0 20px rgba(0,240,255,.1);}
.balance-card h3{font-family:Orbitron;}
.balance-amount{font-family:Orbitron;font-size:1.6rem;}

/* BUTTONS */
button{padding:12px 20px;border:none;border-radius:999px;font-family:Orbitron;background:linear-gradient(90deg,var(--zep-blue),var(--zep-violet));color:#050015;cursor:pointer;transition:.3s;}
button:hover{transform:translateY(-2px);box-shadow:0 0 15px var(--zep-blue),0 0 30px var(--zep-violet);}
.create-invoice-btn{align-self:flex-start;margin-top:10px;}

/* ZAC CHART */
#zacChartContainer{background:var(--glass);padding:20px;border-radius:18px;border:1px solid rgba(255,255,255,.12);}

/* NOTIFICATIONS */
.notification-center{background:var(--glass);padding:16px;border-radius:18px;border:1px solid rgba(255,255,255,.12);max-height:300px;overflow-y:auto;}
.notification{padding:10px;border-radius:12px;margin-bottom:8px;cursor:pointer;transition:.2s;display:flex;justify-content:space-between;align-items:center;}
.notification:hover{background:rgba(255,255,255,.1);}
.notification.pending{border-left:4px solid var(--yellow);}
.notification.escrow{border-left:4px solid var(--zep-blue);}
.notification.submitted{border-left:4px solid var(--purple);}
.notification.released{border-left:4px solid var(--green);}

/* RESPONSIVE */
@media(max-width:600px){.balance-card{flex-direction:column;align-items:flex-start;gap:12px;}}
</style>
</head>
<body>

<header>
  <div class="brand" onclick="location.href='student-dashboard.html'">Zep Swipe</div>
  <button class="home-btn" onclick="location.href='student-dashboard.html'">üè†</button>
</header>

<div class="container">

  <!-- BALANCES -->
  <div class="balance-card">
    <div>
      <h3>USD Wallet</h3>
      <p class="balance-amount" id="usdBalance">$0.00</p>
    </div>
    <div>
      <h3>ZAC Wallet</h3>
      <p class="balance-amount" id="zacBalance">0 ZAC</p>
    </div>
  </div>

  <!-- DAILY TASK BUTTON -->
  <button onclick="completeDailyTask()">Complete Daily Task +25 ZAC</button>

  <!-- CREATE INVOICE -->
  <button class="create-invoice-btn" onclick="location.href='create-invoice.html'">Create Invoice</button>

  <!-- ZAC CHART -->
  <div id="zacChartContainer">
    <canvas id="zacChart"></canvas>
  </div>

  <!-- NOTIFICATION CENTER -->
  <div class="notification-center">
    <h3>Notifications</h3>
    <div id="notificationsList"></div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Initialize Users & Current
let users = JSON.parse(localStorage.getItem("users")) || {};
let currentUserId = localStorage.getItem("currentUserId");
if(!currentUserId || !users[currentUserId]) location.href="login.html";
let currentUser = users[currentUserId];

// ZAC & USD Balances
const usdBalanceEl = document.getElementById("usdBalance");
const zacBalanceEl = document.getElementById("zacBalance");

// Notifications
let notifications = JSON.parse(localStorage.getItem("notifications")) || [];

// Render Wallet
function renderWallet(){
  usdBalanceEl.innerText = `$${currentUser.walletBalance?.toFixed(2)||0}`;
  zacBalanceEl.innerText = `${currentUser.zacBalance||0} ZAC`;
}
renderWallet();

// Daily Task + ZAC
function completeDailyTask(){
  currentUser.zacBalance = (currentUser.zacBalance||0)+25;
  users[currentUserId] = currentUser;
  localStorage.setItem("users",JSON.stringify(users));

  addNotification({type:"submitted",text:"Daily Learn & Earn task completed +25 ZAC",invoiceId:null});
  updateChart();
  renderWallet();
}

// Chart
const ctx = document.getElementById('zacChart').getContext('2d');
let zacChart = new Chart(ctx,{
  type:'line',
  data:{labels:[],datasets:[{label:'Daily ZAC',data:[],backgroundColor:'rgba(0,255,148,0.2)',borderColor:'var(--green)',borderWidth:2,tension:0.3}]},
  options:{scales:{y:{beginAtZero:true}}}
});
function updateChart(){
  if(!currentUser.zacHistory) currentUser.zacHistory=[];
  currentUser.zacHistory.push({day:new Date().toLocaleDateString(),zac:currentUser.zacBalance});
  users[currentUserId]=currentUser;
  localStorage.setItem("users",JSON.stringify(users));

  zacChart.data.labels = currentUser.zacHistory.map(e=>e.day);
  zacChart.data.datasets[0].data = currentUser.zacHistory.map(e=>e.zac);
  zacChart.update();
}

// Notifications
const notificationsList = document.getElementById("notificationsList");
function renderNotifications(){
  notificationsList.innerHTML="";
  notifications.forEach((n,i)=>{
    const div = document.createElement("div");
    div.className=`notification ${n.type}`;
    div.innerHTML=`<span>${n.text}</span>`;
    if(n.invoiceId) div.onclick=()=>{window.location.href=`invoice.html?invoice_id=${n.invoiceId}`;};
    notificationsList.appendChild(div);
  });
}
function addNotification(n){
  notifications.push(n);
  localStorage.setItem("notifications",JSON.stringify(notifications));
  renderNotifications();
}
renderNotifications();

// Live Wallet Update from Invoices
window.addEventListener("storage",(e)=>{
  if(e.key && e.key.startsWith("invoice_")){
    const inv = JSON.parse(e.newValue);
    if(inv.status==="Released" && inv.studentId===currentUserId){
      currentUser.walletBalance = (currentUser.walletBalance||0)+inv.total;
      users[currentUserId]=currentUser;
      localStorage.setItem("users",JSON.stringify(users));
      addNotification({type:"released",text:`Invoice ${inv.id} funds released!`,invoiceId:inv.id});
      renderWallet();
    }
  }
});

// Initial demo invoice notifications
Object.keys(localStorage).forEach(k=>{
  if(k.startsWith("invoice_")){
    const inv = JSON.parse(localStorage.getItem(k));
    if(inv.studentId===currentUserId){
      const colorType = inv.status.toLowerCase();
      addNotification({type:colorType,text:`Invoice ${inv.id} status: ${inv.status}`,invoiceId:inv.id});
    }
  }
});
</script>
</body>
</html>